// <auto-generated/>
// Generated HttpContext-native Query protocol handler for Sns
#if ASPNETCORE

using System.Buffers;
using System.Net;
using System.Text;
using Amazon.SimpleNotificationService;
using Amazon.SimpleNotificationService.Model;
using Amazon.Runtime;
using LocalSqsSnsMessaging.Http;
using Microsoft.AspNetCore.Http;

namespace LocalSqsSnsMessaging.Http.Handlers;

internal static partial class SnsOperationHandler
{
    public static async Task HandleAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        string operationName,
        InMemoryAwsBus bus,
        CancellationToken cancellationToken)
    {
        ArgumentNullException.ThrowIfNull(context);
        ArgumentNullException.ThrowIfNull(operationName);
        ArgumentNullException.ThrowIfNull(bus);

        using IAmazonSimpleNotificationService client = bus.CreateRawSnsClient();

        switch (operationName)
        {
            case "AddPermission":
                await HandleHttpContextAddPermissionAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "CheckIfPhoneNumberIsOptedOut":
                await HandleHttpContextCheckIfPhoneNumberIsOptedOutAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ConfirmSubscription":
                await HandleHttpContextConfirmSubscriptionAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "CreatePlatformApplication":
                await HandleHttpContextCreatePlatformApplicationAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "CreatePlatformEndpoint":
                await HandleHttpContextCreatePlatformEndpointAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "CreateSMSSandboxPhoneNumber":
                await HandleHttpContextCreateSMSSandboxPhoneNumberAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "CreateTopic":
                await HandleHttpContextCreateTopicAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "DeleteEndpoint":
                await HandleHttpContextDeleteEndpointAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "DeletePlatformApplication":
                await HandleHttpContextDeletePlatformApplicationAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "DeleteSMSSandboxPhoneNumber":
                await HandleHttpContextDeleteSMSSandboxPhoneNumberAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "DeleteTopic":
                await HandleHttpContextDeleteTopicAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "GetDataProtectionPolicy":
                await HandleHttpContextGetDataProtectionPolicyAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "GetEndpointAttributes":
                await HandleHttpContextGetEndpointAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "GetPlatformApplicationAttributes":
                await HandleHttpContextGetPlatformApplicationAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "GetSMSAttributes":
                await HandleHttpContextGetSMSAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "GetSMSSandboxAccountStatus":
                await HandleHttpContextGetSMSSandboxAccountStatusAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "GetSubscriptionAttributes":
                await HandleHttpContextGetSubscriptionAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "GetTopicAttributes":
                await HandleHttpContextGetTopicAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListEndpointsByPlatformApplication":
                await HandleHttpContextListEndpointsByPlatformApplicationAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListOriginationNumbers":
                await HandleHttpContextListOriginationNumbersAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListPhoneNumbersOptedOut":
                await HandleHttpContextListPhoneNumbersOptedOutAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListPlatformApplications":
                await HandleHttpContextListPlatformApplicationsAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListSMSSandboxPhoneNumbers":
                await HandleHttpContextListSMSSandboxPhoneNumbersAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListSubscriptions":
                await HandleHttpContextListSubscriptionsAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListSubscriptionsByTopic":
                await HandleHttpContextListSubscriptionsByTopicAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListTagsForResource":
                await HandleHttpContextListTagsForResourceAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListTopics":
                await HandleHttpContextListTopicsAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "OptInPhoneNumber":
                await HandleHttpContextOptInPhoneNumberAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "Publish":
                await HandleHttpContextPublishAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "PublishBatch":
                await HandleHttpContextPublishBatchAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "PutDataProtectionPolicy":
                await HandleHttpContextPutDataProtectionPolicyAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "RemovePermission":
                await HandleHttpContextRemovePermissionAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "SetEndpointAttributes":
                await HandleHttpContextSetEndpointAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "SetPlatformApplicationAttributes":
                await HandleHttpContextSetPlatformApplicationAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "SetSMSAttributes":
                await HandleHttpContextSetSMSAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "SetSubscriptionAttributes":
                await HandleHttpContextSetSubscriptionAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "SetTopicAttributes":
                await HandleHttpContextSetTopicAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "Subscribe":
                await HandleHttpContextSubscribeAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "TagResource":
                await HandleHttpContextTagResourceAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "Unsubscribe":
                await HandleHttpContextUnsubscribeAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "UntagResource":
                await HandleHttpContextUntagResourceAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "VerifySMSSandboxPhoneNumber":
                await HandleHttpContextVerifySMSSandboxPhoneNumberAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            default:
                throw new NotSupportedException($"Sns operation '{operationName}' is not supported.");
        }
    }

    private static async Task HandleHttpContextAddPermissionAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeAddPermissionRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.AddPermissionAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeAddPermissionResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextCheckIfPhoneNumberIsOptedOutAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeCheckIfPhoneNumberIsOptedOutRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.CheckIfPhoneNumberIsOptedOutAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeCheckIfPhoneNumberIsOptedOutResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextConfirmSubscriptionAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeConfirmSubscriptionRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ConfirmSubscriptionAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeConfirmSubscriptionResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextCreatePlatformApplicationAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeCreatePlatformApplicationRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.CreatePlatformApplicationAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeCreatePlatformApplicationResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextCreatePlatformEndpointAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeCreatePlatformEndpointRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.CreatePlatformEndpointAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeCreatePlatformEndpointResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextCreateSMSSandboxPhoneNumberAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeCreateSMSSandboxPhoneNumberRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.CreateSMSSandboxPhoneNumberAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeCreateSMSSandboxPhoneNumberResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextCreateTopicAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeCreateTopicRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.CreateTopicAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeCreateTopicResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextDeleteEndpointAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeDeleteEndpointRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.DeleteEndpointAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeDeleteEndpointResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextDeletePlatformApplicationAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeDeletePlatformApplicationRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.DeletePlatformApplicationAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeDeletePlatformApplicationResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextDeleteSMSSandboxPhoneNumberAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeDeleteSMSSandboxPhoneNumberRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.DeleteSMSSandboxPhoneNumberAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeDeleteSMSSandboxPhoneNumberResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextDeleteTopicAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeDeleteTopicRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.DeleteTopicAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeDeleteTopicResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextGetDataProtectionPolicyAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeGetDataProtectionPolicyRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.GetDataProtectionPolicyAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeGetDataProtectionPolicyResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextGetEndpointAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeGetEndpointAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.GetEndpointAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeGetEndpointAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextGetPlatformApplicationAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeGetPlatformApplicationAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.GetPlatformApplicationAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeGetPlatformApplicationAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextGetSMSAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeGetSMSAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.GetSMSAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeGetSMSAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextGetSMSSandboxAccountStatusAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeGetSMSSandboxAccountStatusRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.GetSMSSandboxAccountStatusAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeGetSMSSandboxAccountStatusResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextGetSubscriptionAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeGetSubscriptionAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.GetSubscriptionAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeGetSubscriptionAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextGetTopicAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeGetTopicAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.GetTopicAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeGetTopicAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListEndpointsByPlatformApplicationAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeListEndpointsByPlatformApplicationRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ListEndpointsByPlatformApplicationAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeListEndpointsByPlatformApplicationResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListOriginationNumbersAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeListOriginationNumbersRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ListOriginationNumbersAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeListOriginationNumbersResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListPhoneNumbersOptedOutAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeListPhoneNumbersOptedOutRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ListPhoneNumbersOptedOutAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeListPhoneNumbersOptedOutResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListPlatformApplicationsAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeListPlatformApplicationsRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ListPlatformApplicationsAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeListPlatformApplicationsResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListSMSSandboxPhoneNumbersAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeListSMSSandboxPhoneNumbersRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ListSMSSandboxPhoneNumbersAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeListSMSSandboxPhoneNumbersResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListSubscriptionsAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeListSubscriptionsRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ListSubscriptionsAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeListSubscriptionsResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListSubscriptionsByTopicAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeListSubscriptionsByTopicRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ListSubscriptionsByTopicAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeListSubscriptionsByTopicResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListTagsForResourceAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeListTagsForResourceRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ListTagsForResourceAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeListTagsForResourceResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListTopicsAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeListTopicsRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.ListTopicsAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeListTopicsResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextOptInPhoneNumberAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeOptInPhoneNumberRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.OptInPhoneNumberAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeOptInPhoneNumberResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextPublishAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializePublishRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.PublishAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializePublishResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextPublishBatchAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializePublishBatchRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.PublishBatchAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializePublishBatchResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextPutDataProtectionPolicyAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializePutDataProtectionPolicyRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.PutDataProtectionPolicyAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializePutDataProtectionPolicyResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextRemovePermissionAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeRemovePermissionRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.RemovePermissionAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeRemovePermissionResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextSetEndpointAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeSetEndpointAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.SetEndpointAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeSetEndpointAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextSetPlatformApplicationAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeSetPlatformApplicationAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.SetPlatformApplicationAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeSetPlatformApplicationAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextSetSMSAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeSetSMSAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.SetSMSAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeSetSMSAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextSetSubscriptionAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeSetSubscriptionAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.SetSubscriptionAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeSetSubscriptionAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextSetTopicAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeSetTopicAttributesRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.SetTopicAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeSetTopicAttributesResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextSubscribeAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeSubscribeRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.SubscribeAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeSubscribeResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextTagResourceAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeTagResourceRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.TagResourceAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeTagResourceResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextUnsubscribeAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeUnsubscribeRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.UnsubscribeAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeUnsubscribeResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextUntagResourceAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeUntagResourceRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.UntagResourceAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeUntagResourceResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextVerifySMSSandboxPhoneNumberAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        IAmazonSimpleNotificationService client,
        CancellationToken cancellationToken)
    {
        try
        {
            var requestObject = SnsQuerySerializers.DeserializeVerifySMSSandboxPhoneNumberRequest(requestBody.AsSpan(0, requestBodyLength));
            var result = await client.VerifySMSSandboxPhoneNumberAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "text/xml; charset=utf-8";

            using var pooledBuffer = PooledArrayBufferWriter.Rent();
            SnsQuerySerializers.SerializeVerifySMSSandboxPhoneNumberResponse(result, pooledBuffer.Writer);
            await context.Response.Body.WriteAsync(pooledBuffer.Writer.WrittenMemory, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AmazonServiceException ex)
        {
            await WriteQueryErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task WriteQueryErrorResponseAsync(HttpContext context, Exception exception, CancellationToken cancellationToken)
    {
        string errorCode;
        string errorMessage;
        int statusCode;

        if (exception is AmazonServiceException awsException)
        {
            errorCode = awsException.ErrorCode ?? exception.GetType().Name.Replace("Exception", "");
            errorMessage = awsException.Message;
            statusCode = (int)awsException.StatusCode;
        }
        else
        {
            errorCode = exception.GetType().Name.Replace("Exception", "");
            errorMessage = exception.Message;
            statusCode = 500;
        }

        var errorXml = $"""
        <?xml version="1.0" encoding="UTF-8"?>
        <ErrorResponse xmlns="http://sns.amazonaws.com/doc/2010-03-31/">
            <Error>
                <Type>Sender</Type>
                <Code>{errorCode}</Code>
                <Message>{System.Security.SecurityElement.Escape(errorMessage)}</Message>
            </Error>
            <RequestId>{Guid.NewGuid()}</RequestId>
        </ErrorResponse>
        """;

        context.Response.StatusCode = statusCode;
        context.Response.ContentType = "text/xml; charset=utf-8";

        var errorBytes = Encoding.UTF8.GetBytes(errorXml);
        await context.Response.Body.WriteAsync(errorBytes, cancellationToken).ConfigureAwait(false);
    }
}

#endif
