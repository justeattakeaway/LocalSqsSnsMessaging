// <auto-generated/>
// Generated HttpContext-native JSON protocol handler for Sqs
#if ASPNETCORE

using System.Text;
using LocalSqsSnsMessaging.Sqs.Model;
using Microsoft.AspNetCore.Http;

namespace LocalSqsSnsMessaging.Http.Handlers;

internal static partial class SqsOperationHandler
{
    public static async Task HandleAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        string operationName,
        InMemoryAwsBus bus,
        CancellationToken cancellationToken)
    {
        ArgumentNullException.ThrowIfNull(context);
        ArgumentNullException.ThrowIfNull(operationName);
        ArgumentNullException.ThrowIfNull(bus);

        var client = new InternalSqsClient(bus);

        switch (operationName)
        {
            case "AddPermission":
                await HandleHttpContextAddPermissionAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "CancelMessageMoveTask":
                await HandleHttpContextCancelMessageMoveTaskAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ChangeMessageVisibility":
                await HandleHttpContextChangeMessageVisibilityAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ChangeMessageVisibilityBatch":
                await HandleHttpContextChangeMessageVisibilityBatchAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "CreateQueue":
                await HandleHttpContextCreateQueueAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "DeleteMessage":
                await HandleHttpContextDeleteMessageAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "DeleteMessageBatch":
                await HandleHttpContextDeleteMessageBatchAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "DeleteQueue":
                await HandleHttpContextDeleteQueueAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "GetQueueAttributes":
                await HandleHttpContextGetQueueAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "GetQueueUrl":
                await HandleHttpContextGetQueueUrlAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListDeadLetterSourceQueues":
                await HandleHttpContextListDeadLetterSourceQueuesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListMessageMoveTasks":
                await HandleHttpContextListMessageMoveTasksAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListQueueTags":
                await HandleHttpContextListQueueTagsAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ListQueues":
                await HandleHttpContextListQueuesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "PurgeQueue":
                await HandleHttpContextPurgeQueueAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "ReceiveMessage":
                await HandleHttpContextReceiveMessageAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "RemovePermission":
                await HandleHttpContextRemovePermissionAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "SendMessage":
                await HandleHttpContextSendMessageAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "SendMessageBatch":
                await HandleHttpContextSendMessageBatchAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "SetQueueAttributes":
                await HandleHttpContextSetQueueAttributesAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "StartMessageMoveTask":
                await HandleHttpContextStartMessageMoveTaskAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "TagQueue":
                await HandleHttpContextTagQueueAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            case "UntagQueue":
                await HandleHttpContextUntagQueueAsync(context, requestBody, requestBodyLength, client, cancellationToken).ConfigureAwait(false);
                break;
            default:
                throw new NotSupportedException($"Sqs operation '{operationName}' is not supported.");
        }
    }

    private static async Task HandleHttpContextAddPermissionAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeAddPermissionRequest(requestStream);
            var result = await client.AddPermissionAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeAddPermissionResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextCancelMessageMoveTaskAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeCancelMessageMoveTaskRequest(requestStream);
            var result = await client.CancelMessageMoveTaskAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeCancelMessageMoveTaskResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextChangeMessageVisibilityAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeChangeMessageVisibilityRequest(requestStream);
            var result = await client.ChangeMessageVisibilityAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeChangeMessageVisibilityResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextChangeMessageVisibilityBatchAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeChangeMessageVisibilityBatchRequest(requestStream);
            var result = await client.ChangeMessageVisibilityBatchAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeChangeMessageVisibilityBatchResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextCreateQueueAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeCreateQueueRequest(requestStream);
            var result = await client.CreateQueueAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeCreateQueueResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextDeleteMessageAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeDeleteMessageRequest(requestStream);
            var result = await client.DeleteMessageAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeDeleteMessageResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextDeleteMessageBatchAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeDeleteMessageBatchRequest(requestStream);
            var result = await client.DeleteMessageBatchAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeDeleteMessageBatchResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextDeleteQueueAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeDeleteQueueRequest(requestStream);
            var result = await client.DeleteQueueAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeDeleteQueueResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextGetQueueAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeGetQueueAttributesRequest(requestStream);
            var result = await client.GetQueueAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeGetQueueAttributesResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextGetQueueUrlAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeGetQueueUrlRequest(requestStream);
            var result = await client.GetQueueUrlAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeGetQueueUrlResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListDeadLetterSourceQueuesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeListDeadLetterSourceQueuesRequest(requestStream);
            var result = await client.ListDeadLetterSourceQueuesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeListDeadLetterSourceQueuesResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListMessageMoveTasksAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeListMessageMoveTasksRequest(requestStream);
            var result = await client.ListMessageMoveTasksAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeListMessageMoveTasksResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListQueueTagsAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeListQueueTagsRequest(requestStream);
            var result = await client.ListQueueTagsAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeListQueueTagsResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextListQueuesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeListQueuesRequest(requestStream);
            var result = await client.ListQueuesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeListQueuesResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextPurgeQueueAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializePurgeQueueRequest(requestStream);
            var result = await client.PurgeQueueAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializePurgeQueueResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextReceiveMessageAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeReceiveMessageRequest(requestStream);
            var result = await client.ReceiveMessageAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeReceiveMessageResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextRemovePermissionAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeRemovePermissionRequest(requestStream);
            var result = await client.RemovePermissionAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeRemovePermissionResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextSendMessageAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeSendMessageRequest(requestStream);
            var result = await client.SendMessageAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeSendMessageResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextSendMessageBatchAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeSendMessageBatchRequest(requestStream);
            var result = await client.SendMessageBatchAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeSendMessageBatchResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextSetQueueAttributesAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeSetQueueAttributesRequest(requestStream);
            var result = await client.SetQueueAttributesAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeSetQueueAttributesResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextStartMessageMoveTaskAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeStartMessageMoveTaskRequest(requestStream);
            var result = await client.StartMessageMoveTaskAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeStartMessageMoveTaskResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextTagQueueAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeTagQueueRequest(requestStream);
            var result = await client.TagQueueAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeTagQueueResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task HandleHttpContextUntagQueueAsync(
        HttpContext context,
        byte[] requestBody,
        int requestBodyLength,
        InternalSqsClient client,
        CancellationToken cancellationToken)
    {
        try
        {
            using var requestStream = new MemoryStream(requestBody, 0, requestBodyLength, writable: false);
            var requestObject = SqsJsonSerializers.DeserializeUntagQueueRequest(requestStream);
            var result = await client.UntagQueueAsync(requestObject, cancellationToken).ConfigureAwait(false);

            context.Response.StatusCode = 200;
            context.Response.ContentType = "application/x-amz-json-1.0";
            using var responseBuffer = new MemoryStream();
            SqsJsonSerializers.SerializeUntagQueueResponse(result, responseBuffer);
            responseBuffer.Position = 0;
            await responseBuffer.CopyToAsync(context.Response.Body, cancellationToken).ConfigureAwait(false);
        }
        catch (OperationCanceledException)
        {
            throw;
        }
        catch (AwsServiceException ex)
        {
            await WriteJsonErrorResponseAsync(context, ex, cancellationToken).ConfigureAwait(false);
        }
    }

    private static async Task WriteJsonErrorResponseAsync(HttpContext context, Exception exception, CancellationToken cancellationToken)
    {
        string errorCode;
        string errorMessage;
        int statusCode;

        if (exception is AwsServiceException awsException)
        {
            errorCode = awsException.ErrorCode ?? exception.GetType().Name.Replace("Exception", "");
            errorMessage = awsException.Message;
            statusCode = (int)awsException.StatusCode;
        }
        else
        {
            errorCode = exception.GetType().Name.Replace("Exception", "");
            errorMessage = exception.Message;
            statusCode = 500;
        }

        var errorType = $"com.amazonaws.sqs#{errorCode}";

        context.Response.StatusCode = statusCode;
        context.Response.ContentType = "application/x-amz-json-1.0";

        var errorJson = $$"""
        {
            "__type": "{{errorType}}",
            "message": "{{errorMessage.Replace("\"", "\\\"", StringComparison.Ordinal)}}"
        }
        """;

        var errorBytes = Encoding.UTF8.GetBytes(errorJson);
        await context.Response.Body.WriteAsync(errorBytes, cancellationToken).ConfigureAwait(false);
    }
}

#endif
